

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Allocation Functions &mdash; libEnsemble</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/my_theme.css?v=dd6640cf" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../_static/libE_logo_circle.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=bcd630d1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Calling Scripts" href="calling_scripts.html" />
    <link rel="prev" title="Mock simulation evaluations (re-run using history file)" href="sim_funcs/mock_sim.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="libensemble" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/examples/alloc_funcs.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/libE_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview_usecases.html">Understanding libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming_libE.html">Constructing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_libE.html">Running libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/platforms_index.html">Running on HPC Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/local_sine_tutorial.html">Simple Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/executor_forces_tutorial.html">Ensemble with an MPI Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/forces_gpu_tutorial.html">Executor - Assign GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/gpcam_tutorial.html">Surrogate Modeling with gpCAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/aposmm_tutorial.html">Optimization with APOSMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/calib_cancel_tutorial.html">Calibration with Simulation Cancellation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gen_funcs.html">Generator Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sim_funcs.html">Simulation Functions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Allocation Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-give_sim_work_first">give_sim_work_first</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#give_sim_work_first.give_sim_work_first"><code class="docutils literal notranslate"><span class="pre">give_sim_work_first()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-fast_alloc">fast_alloc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fast_alloc.give_sim_work_first"><code class="docutils literal notranslate"><span class="pre">give_sim_work_first()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-start_only_persistent">start_only_persistent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start_only_persistent.only_persistent_gens"><code class="docutils literal notranslate"><span class="pre">only_persistent_gens()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-start_persistent_local_opt_gens">start_persistent_local_opt_gens</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start_persistent_local_opt_gens.start_persistent_local_opt_gens"><code class="docutils literal notranslate"><span class="pre">start_persistent_local_opt_gens()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-fast_alloc_and_pausing">fast_alloc_and_pausing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fast_alloc_and_pausing.give_sim_work_first"><code class="docutils literal notranslate"><span class="pre">give_sim_work_first()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-only_one_gen_alloc">only_one_gen_alloc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#only_one_gen_alloc.ensure_one_active_gen"><code class="docutils literal notranslate"><span class="pre">ensure_one_active_gen()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-start_fd_persistent">start_fd_persistent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start_fd_persistent.finite_diff_alloc"><code class="docutils literal notranslate"><span class="pre">finite_diff_alloc()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-persistent_aposmm_alloc">persistent_aposmm_alloc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#persistent_aposmm_alloc.persistent_aposmm_alloc"><code class="docutils literal notranslate"><span class="pre">persistent_aposmm_alloc()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-give_pregenerated_work">give_pregenerated_work</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#give_pregenerated_work.give_pregenerated_sim_work"><code class="docutils literal notranslate"><span class="pre">give_pregenerated_sim_work()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-inverse_bayes_allocf">inverse_bayes_allocf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#inverse_bayes_allocf.only_persistent_gens_for_inverse_bayes"><code class="docutils literal notranslate"><span class="pre">only_persistent_gens_for_inverse_bayes()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="calling_scripts.html">Calling Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="submission_scripts.html">Submission Scripts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../posters.html">Posters and Presentations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/release_management/release_index.html">Release Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/dev_API/developer_API.html">Internal Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">libEnsemble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Allocation Functions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/alloc_funcs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="allocation-functions">
<span id="examples-alloc"></span><h1>Allocation Functions<a class="headerlink" href="#allocation-functions" title="Link to this heading"></a></h1>
<p>Below are example allocation functions available in libEnsemble.</p>
<p>Many users use these unmodified.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>See the API for allocation functions <a class="reference internal" href="../function_guides/sim_gen_alloc_api.html#api-alloc-f"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default allocation function (for non-persistent generators) is <a class="reference internal" href="#gswf-label"><span class="std std-ref">give_sim_work_first</span></a>.</p>
<p>The most commonly used (for persistent generators) is <a class="reference internal" href="#start-only-persistent-label"><span class="std std-ref">start_only_persistent</span></a>.</p>
</div>
<section id="module-give_sim_work_first">
<span id="give-sim-work-first"></span><span id="gswf-label"></span><h2>give_sim_work_first<a class="headerlink" href="#module-give_sim_work_first" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="give_sim_work_first.give_sim_work_first">
<span class="sig-prename descclassname"><span class="pre">give_sim_work_first.</span></span><span class="sig-name descname"><span class="pre">give_sim_work_first</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#give_sim_work_first.give_sim_work_first" title="Link to this definition"></a></dt>
<dd><p>Decide what should be given to workers. This allocation function gives any
available simulation work first, and only when all simulations are
completed or running does it start (at most <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;num_active_gens&quot;]</span></code>)
generator instances.</p>
<p>Allows for a <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;batch_mode&quot;]</span></code> where no generation
work is given out unless all entries in <code class="docutils literal notranslate"><span class="pre">H</span></code> are returned.</p>
<p>Can give points in highest priority, if <code class="docutils literal notranslate"><span class="pre">&quot;priority&quot;</span></code> is a field in <code class="docutils literal notranslate"><span class="pre">H</span></code>.
If <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;give_all_with_same_priority&quot;]</span></code> is set to True, then
all points with the same priority value are given as a batch to the sim.</p>
<p>Workers performing sims will be assigned resources given in H[“resource_sets”]
this field exists, else defaulting to one. Workers performing gens are
assigned resource_sets given by persis_info[“gen_resources”] or zero.</p>
<p>This is the default allocation function if one is not defined.</p>
<p>tags: alloc, default, batch, priority</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_uniform_sampling.py">test_uniform_sampling.py</a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>W</strong> (<em>ndarray</em><em>[</em><em>tuple</em><em>[</em><em>int</em><em>, </em><em>...</em><em>]</em><em>, </em><em>dtype</em><em>[</em><em>_ScalarType_co</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>H</strong> (<em>ndarray</em><em>[</em><em>tuple</em><em>[</em><em>int</em><em>, </em><em>...</em><em>]</em><em>, </em><em>dtype</em><em>[</em><em>_ScalarType_co</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>sim_specs</strong> (<em>dict</em>)</p></li>
<li><p><strong>gen_specs</strong> (<em>dict</em>)</p></li>
<li><p><strong>alloc_specs</strong> (<em>dict</em>)</p></li>
<li><p><strong>persis_info</strong> (<em>dict</em>)</p></li>
<li><p><strong>libE_info</strong> (<em>dict</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[dict]</p>
</dd>
</dl>
</dd></dl>

<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text"><span class="underline">give_sim_work_first.py</span></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 4</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.tools.alloc_support</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllocSupport</span><span class="p">,</span> <span class="n">InsufficientFreeResources</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span><span class="w"> </span><span class="nf">give_sim_work_first</span><span class="p">(</span>
<span class="linenos">10</span>    <span class="n">W</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<span class="linenos">11</span>    <span class="n">H</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span>
<span class="linenos">12</span>    <span class="n">sim_specs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="n">gen_specs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos">14</span>    <span class="n">alloc_specs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos">15</span>    <span class="n">persis_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos">16</span>    <span class="n">libE_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos">17</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="linenos">18</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">19</span><span class="sd">    Decide what should be given to workers. This allocation function gives any</span>
<span class="linenos">20</span><span class="sd">    available simulation work first, and only when all simulations are</span>
<span class="linenos">21</span><span class="sd">    completed or running does it start (at most ``alloc_specs[&quot;user&quot;][&quot;num_active_gens&quot;]``)</span>
<span class="linenos">22</span><span class="sd">    generator instances.</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="sd">    Allows for a ``alloc_specs[&quot;user&quot;][&quot;batch_mode&quot;]`` where no generation</span>
<span class="linenos">25</span><span class="sd">    work is given out unless all entries in ``H`` are returned.</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="sd">    Can give points in highest priority, if ``&quot;priority&quot;`` is a field in ``H``.</span>
<span class="linenos">28</span><span class="sd">    If ``alloc_specs[&quot;user&quot;][&quot;give_all_with_same_priority&quot;]`` is set to True, then</span>
<span class="linenos">29</span><span class="sd">    all points with the same priority value are given as a batch to the sim.</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="sd">    Workers performing sims will be assigned resources given in H[&quot;resource_sets&quot;]</span>
<span class="linenos">32</span><span class="sd">    this field exists, else defaulting to one. Workers performing gens are</span>
<span class="linenos">33</span><span class="sd">    assigned resource_sets given by persis_info[&quot;gen_resources&quot;] or zero.</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="sd">    This is the default allocation function if one is not defined.</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="sd">    tags: alloc, default, batch, priority</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="sd">    .. seealso::</span>
<span class="linenos">40</span><span class="sd">        `test_uniform_sampling.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_uniform_sampling.py&gt;`_ # noqa</span>
<span class="linenos">41</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="n">user</span> <span class="o">=</span> <span class="n">alloc_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="k">if</span> <span class="s2">&quot;cancel_sims_time&quot;</span> <span class="ow">in</span> <span class="n">user</span><span class="p">:</span>
<span class="linenos">46</span>        <span class="c1"># Cancel simulations that are taking too long</span>
<span class="linenos">47</span>        <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_started&quot;</span><span class="p">],</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_ended&quot;</span><span class="p">],</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;cancel_requested&quot;</span><span class="p">])))[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">48</span>        <span class="n">inds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_started_time&quot;</span><span class="p">][</span><span class="n">rows</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;cancel_sims_time&quot;</span><span class="p">]</span>
<span class="linenos">49</span>        <span class="n">to_request_cancel</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
<span class="linenos">50</span>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">to_request_cancel</span><span class="p">:</span>
<span class="linenos">51</span>            <span class="n">H</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="s2">&quot;cancel_requested&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">52</span>
<span class="linenos">53</span>    <span class="k">if</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;sim_max_given&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;any_idle_workers&quot;</span><span class="p">]:</span>
<span class="linenos">54</span>        <span class="k">return</span> <span class="p">{},</span> <span class="n">persis_info</span>
<span class="linenos">55</span>
<span class="linenos">56</span>    <span class="c1"># Initialize alloc_specs[&quot;user&quot;] as user.</span>
<span class="linenos">57</span>    <span class="n">batch_give</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;give_all_with_same_priority&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">58</span>    <span class="n">gen_in</span> <span class="o">=</span> <span class="n">gen_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="p">[])</span>
<span class="linenos">59</span>
<span class="linenos">60</span>    <span class="n">manage_resources</span> <span class="o">=</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;use_resource_sets&quot;</span><span class="p">]</span>
<span class="linenos">61</span>    <span class="n">support</span> <span class="o">=</span> <span class="n">AllocSupport</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">manage_resources</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">)</span>
<span class="linenos">62</span>    <span class="n">gen_count</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">count_gens</span><span class="p">()</span>
<span class="linenos">63</span>    <span class="n">Work</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="n">points_to_evaluate</span> <span class="o">=</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_started&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;cancel_requested&quot;</span><span class="p">]</span>
<span class="linenos">66</span>
<span class="linenos">67</span>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">points_to_evaluate</span><span class="p">):</span>
<span class="linenos">68</span>        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">gen_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos">69</span>            <span class="n">sim_ids_to_send</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">points_by_priority</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">points_avail</span><span class="o">=</span><span class="n">points_to_evaluate</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">batch_give</span><span class="p">)</span>
<span class="linenos">70</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">71</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">sim_work</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">],</span> <span class="n">sim_ids_to_send</span><span class="p">,</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<span class="linenos">72</span>            <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">73</span>                <span class="k">break</span>
<span class="linenos">74</span>            <span class="n">points_to_evaluate</span><span class="p">[</span><span class="n">sim_ids_to_send</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">75</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">points_to_evaluate</span><span class="p">):</span>
<span class="linenos">76</span>                <span class="k">break</span>
<span class="linenos">77</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">78</span>        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">gen_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">79</span>            <span class="c1"># Allow at most num_active_gens active generator instances</span>
<span class="linenos">80</span>            <span class="k">if</span> <span class="n">gen_count</span> <span class="o">&gt;=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_active_gens&quot;</span><span class="p">,</span> <span class="n">gen_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">81</span>                <span class="k">break</span>
<span class="linenos">82</span>
<span class="linenos">83</span>            <span class="c1"># Do not start gen instances in batch mode if workers still working</span>
<span class="linenos">84</span>            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch_mode&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">support</span><span class="o">.</span><span class="n">all_sim_ended</span><span class="p">(</span><span class="n">H</span><span class="p">):</span>
<span class="linenos">85</span>                <span class="k">break</span>
<span class="linenos">86</span>
<span class="linenos">87</span>            <span class="c1"># Give gen work</span>
<span class="linenos">88</span>            <span class="n">return_rows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">))</span> <span class="k">if</span> <span class="n">gen_in</span> <span class="k">else</span> <span class="p">[]</span>
<span class="linenos">89</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">90</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">gen_work</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">gen_in</span><span class="p">,</span> <span class="n">return_rows</span><span class="p">,</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<span class="linenos">91</span>            <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">92</span>                <span class="k">break</span>
<span class="linenos">93</span>            <span class="n">gen_count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">94</span>
<span class="linenos">95</span>    <span class="k">return</span> <span class="n">Work</span><span class="p">,</span> <span class="n">persis_info</span>
</pre></div>
</div>
</div>
</details></section>
<section id="module-fast_alloc">
<span id="fast-alloc"></span><h2>fast_alloc<a class="headerlink" href="#module-fast_alloc" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="fast_alloc.give_sim_work_first">
<span class="sig-prename descclassname"><span class="pre">fast_alloc.</span></span><span class="sig-name descname"><span class="pre">give_sim_work_first</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fast_alloc.give_sim_work_first" title="Link to this definition"></a></dt>
<dd><p>This allocation function gives (in order) entries in <code class="docutils literal notranslate"><span class="pre">H</span></code> to idle workers
to evaluate in the simulation function. The fields in <code class="docutils literal notranslate"><span class="pre">sim_specs[&quot;in&quot;]</span></code>
are given. If all entries in <cite>H</cite> have been given a be evaluated, a worker
is told to call the generator function, provided this wouldn’t result in
more than <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;num_active_gen&quot;]</span></code> active generators.</p>
<p>This fast_alloc variation of give_sim_work_first is useful for cases that
simply iterate through H, issuing evaluations in order and, in particular,
is likely to be faster if there will be many short simulation evaluations,
given that this function contains fewer column length operations.</p>
<p>tags: alloc, simple, fast</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_fast_alloc.py">test_fast_alloc.py</a></p>
</div>
</dd></dl>

<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text"><span class="underline">fast_alloc.py</span></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.tools.alloc_support</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllocSupport</span><span class="p">,</span> <span class="n">InsufficientFreeResources</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span><span class="w"> </span><span class="nf">give_sim_work_first</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">,</span> <span class="n">gen_specs</span><span class="p">,</span> <span class="n">alloc_specs</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 6</span><span class="sd">    This allocation function gives (in order) entries in ``H`` to idle workers</span>
<span class="linenos"> 7</span><span class="sd">    to evaluate in the simulation function. The fields in ``sim_specs[&quot;in&quot;]``</span>
<span class="linenos"> 8</span><span class="sd">    are given. If all entries in `H` have been given a be evaluated, a worker</span>
<span class="linenos"> 9</span><span class="sd">    is told to call the generator function, provided this wouldn&#39;t result in</span>
<span class="linenos">10</span><span class="sd">    more than ``alloc_specs[&quot;user&quot;][&quot;num_active_gen&quot;]`` active generators.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    This fast_alloc variation of give_sim_work_first is useful for cases that</span>
<span class="linenos">13</span><span class="sd">    simply iterate through H, issuing evaluations in order and, in particular,</span>
<span class="linenos">14</span><span class="sd">    is likely to be faster if there will be many short simulation evaluations,</span>
<span class="linenos">15</span><span class="sd">    given that this function contains fewer column length operations.</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="sd">    tags: alloc, simple, fast</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="sd">    .. seealso::</span>
<span class="linenos">20</span><span class="sd">        `test_fast_alloc.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_fast_alloc.py&gt;`_ # noqa</span>
<span class="linenos">21</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">if</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;sim_max_given&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;any_idle_workers&quot;</span><span class="p">]:</span>
<span class="linenos">24</span>        <span class="k">return</span> <span class="p">{},</span> <span class="n">persis_info</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="n">user</span> <span class="o">=</span> <span class="n">alloc_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">27</span>    <span class="n">manage_resources</span> <span class="o">=</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;use_resource_sets&quot;</span><span class="p">]</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="n">support</span> <span class="o">=</span> <span class="n">AllocSupport</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">manage_resources</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="n">gen_count</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">count_gens</span><span class="p">()</span>
<span class="linenos">32</span>    <span class="n">Work</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">33</span>    <span class="n">gen_in</span> <span class="o">=</span> <span class="n">gen_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="p">[])</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="c1"># Give sim work if possible</span>
<span class="linenos">36</span>    <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">gen_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos">37</span>        <span class="n">persis_info</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">skip_canceled_points</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">)</span>
<span class="linenos">38</span>        <span class="k">if</span> <span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;next_to_give&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">):</span>
<span class="linenos">39</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">40</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">sim_work</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;next_to_give&quot;</span><span class="p">]],</span> <span class="p">[])</span>
<span class="linenos">41</span>            <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">42</span>                <span class="k">break</span>
<span class="linenos">43</span>            <span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;next_to_give&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="c1"># Give gen work if possible</span>
<span class="linenos">46</span>    <span class="k">if</span> <span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;next_to_give&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">):</span>
<span class="linenos">47</span>        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">gen_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="linenos">48</span>            <span class="k">if</span> <span class="n">wid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Work</span> <span class="ow">and</span> <span class="n">gen_count</span> <span class="o">&lt;</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_active_gens&quot;</span><span class="p">,</span> <span class="n">gen_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">49</span>                <span class="n">return_rows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">))</span> <span class="k">if</span> <span class="n">gen_in</span> <span class="k">else</span> <span class="p">[]</span>
<span class="linenos">50</span>                <span class="k">try</span><span class="p">:</span>
<span class="linenos">51</span>                    <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">gen_work</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">gen_in</span><span class="p">,</span> <span class="n">return_rows</span><span class="p">,</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<span class="linenos">52</span>                <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">53</span>                    <span class="k">break</span>
<span class="linenos">54</span>                <span class="n">gen_count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">55</span>                <span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;total_gen_calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">56</span>
<span class="linenos">57</span>    <span class="k">return</span> <span class="n">Work</span><span class="p">,</span> <span class="n">persis_info</span>
</pre></div>
</div>
</div>
</details></section>
<section id="module-start_only_persistent">
<span id="start-only-persistent"></span><span id="start-only-persistent-label"></span><h2>start_only_persistent<a class="headerlink" href="#module-start_only_persistent" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="start_only_persistent.only_persistent_gens">
<span class="sig-prename descclassname"><span class="pre">start_only_persistent.</span></span><span class="sig-name descname"><span class="pre">only_persistent_gens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#start_only_persistent.only_persistent_gens" title="Link to this definition"></a></dt>
<dd><p>This allocation function will give simulation work if possible, but
otherwise start up to <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;num_active_gens&quot;]</span></code>
persistent generators (defaulting to one).</p>
<p>By default, evaluation results are given back to the generator once
all generated points have been returned from the simulation evaluation.
If <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;async_return&quot;]</span></code> is set to True, then any
returned points are given back to the generator.</p>
<p>If any workers are marked as zero_resource_workers, then these will only
be used for generators.</p>
<p>If any of the persistent generators has exited, then ensemble shutdown
is triggered.</p>
<p><strong>User options</strong>:</p>
<p>To be provided in calling script: E.g., <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;async_return&quot;]</span> <span class="pre">=</span> <span class="pre">True</span></code></p>
<dl class="simple">
<dt>init_sample_size: int, optional</dt><dd><p>Initial sample size - always return in batch. Default: 0</p>
</dd>
<dt>num_active_gens: int, optional</dt><dd><p>Maximum number of persistent generators to start. Default: 1</p>
</dd>
<dt>async_return: Boolean, optional</dt><dd><p>Return results to gen as they come in (after sample). Default: False (batch return).</p>
</dd>
<dt>give_all_with_same_priority: Boolean, optional</dt><dd><p>If True, then all points with the same priority value are given as a batch to the sim.
Default is False</p>
</dd>
<dt>active_recv_gen: Boolean, optional</dt><dd><p>Create gen in active receive mode. If True, the manager does not need to wait
for a return from the generator before sending further returned points.
Default: False</p>
</dd>
</dl>
<p>tags: alloc, batch, async, persistent, priority</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_sampling.py">test_persistent_uniform_sampling.py</a> 
<a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_sampling_async.py">test_persistent_uniform_sampling_async.py</a> 
<a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/regression_tests/test_persistent_surmise_calib.py">test_persistent_surmise_calib.py</a> 
<a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_gen_decides_stop.py">test_persistent_uniform_gen_decides_stop.py</a></p>
</div>
</dd></dl>

<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text"><span class="underline">start_only_persistent.py</span></span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.message_numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">EVAL_GEN_TAG</span><span class="p">,</span> <span class="n">EVAL_SIM_TAG</span>
<span class="linenos">  4</span><span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.tools.alloc_support</span><span class="w"> </span><span class="kn">import</span> <span class="n">AllocSupport</span><span class="p">,</span> <span class="n">InsufficientFreeResources</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="k">def</span><span class="w"> </span><span class="nf">only_persistent_gens</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">,</span> <span class="n">gen_specs</span><span class="p">,</span> <span class="n">alloc_specs</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">):</span>
<span class="linenos">  8</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  9</span><span class="sd">    This allocation function will give simulation work if possible, but</span>
<span class="linenos"> 10</span><span class="sd">    otherwise start up to ``alloc_specs[&quot;user&quot;][&quot;num_active_gens&quot;]``</span>
<span class="linenos"> 11</span><span class="sd">    persistent generators (defaulting to one).</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="sd">    By default, evaluation results are given back to the generator once</span>
<span class="linenos"> 14</span><span class="sd">    all generated points have been returned from the simulation evaluation.</span>
<span class="linenos"> 15</span><span class="sd">    If ``alloc_specs[&quot;user&quot;][&quot;async_return&quot;]`` is set to True, then any</span>
<span class="linenos"> 16</span><span class="sd">    returned points are given back to the generator.</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="sd">    If any workers are marked as zero_resource_workers, then these will only</span>
<span class="linenos"> 19</span><span class="sd">    be used for generators.</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="sd">    If any of the persistent generators has exited, then ensemble shutdown</span>
<span class="linenos"> 22</span><span class="sd">    is triggered.</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="sd">    **User options**:</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="sd">    To be provided in calling script: E.g., ``alloc_specs[&quot;user&quot;][&quot;async_return&quot;] = True``</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="sd">    init_sample_size: int, optional</span>
<span class="linenos"> 29</span><span class="sd">        Initial sample size - always return in batch. Default: 0</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="sd">    num_active_gens: int, optional</span>
<span class="linenos"> 32</span><span class="sd">        Maximum number of persistent generators to start. Default: 1</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="sd">    async_return: Boolean, optional</span>
<span class="linenos"> 35</span><span class="sd">        Return results to gen as they come in (after sample). Default: False (batch return).</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="sd">    give_all_with_same_priority: Boolean, optional</span>
<span class="linenos"> 38</span><span class="sd">        If True, then all points with the same priority value are given as a batch to the sim.</span>
<span class="linenos"> 39</span><span class="sd">        Default is False</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="sd">    active_recv_gen: Boolean, optional</span>
<span class="linenos"> 42</span><span class="sd">        Create gen in active receive mode. If True, the manager does not need to wait</span>
<span class="linenos"> 43</span><span class="sd">        for a return from the generator before sending further returned points.</span>
<span class="linenos"> 44</span><span class="sd">        Default: False</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="sd">    tags: alloc, batch, async, persistent, priority</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="sd">    .. seealso::</span>
<span class="linenos"> 49</span><span class="sd">        `test_persistent_uniform_sampling.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_sampling.py&gt;`_ # noqa</span>
<span class="linenos"> 50</span><span class="sd">        `test_persistent_uniform_sampling_async.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_sampling_async.py&gt;`_ # noqa</span>
<span class="linenos"> 51</span><span class="sd">        `test_persistent_surmise_calib.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/regression_tests/test_persistent_surmise_calib.py&gt;`_ # noqa</span>
<span class="linenos"> 52</span><span class="sd">        `test_persistent_uniform_gen_decides_stop.py &lt;https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_persistent_uniform_gen_decides_stop.py&gt;`_ # noqa</span>
<span class="linenos"> 53</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="k">if</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;sim_max_given&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;any_idle_workers&quot;</span><span class="p">]:</span>
<span class="linenos"> 56</span>        <span class="k">return</span> <span class="p">{},</span> <span class="n">persis_info</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>    <span class="c1"># Initialize alloc_specs[&quot;user&quot;] as user.</span>
<span class="linenos"> 59</span>    <span class="n">user</span> <span class="o">=</span> <span class="n">alloc_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos"> 60</span>    <span class="n">manage_resources</span> <span class="o">=</span> <span class="n">libE_info</span><span class="p">[</span><span class="s2">&quot;use_resource_sets&quot;</span><span class="p">]</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span>    <span class="n">active_recv_gen</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;active_recv_gen&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Persistent gen can handle irregular communications</span>
<span class="linenos"> 63</span>    <span class="n">init_sample_size</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;init_sample_size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Always batch return until this many evals complete</span>
<span class="linenos"> 64</span>    <span class="n">batch_give</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;give_all_with_same_priority&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>    <span class="n">support</span> <span class="o">=</span> <span class="n">AllocSupport</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">manage_resources</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">)</span>
<span class="linenos"> 67</span>    <span class="n">gen_count</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">count_persis_gens</span><span class="p">()</span>
<span class="linenos"> 68</span>    <span class="n">Work</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>    <span class="c1"># Asynchronous return to generator</span>
<span class="linenos"> 71</span>    <span class="n">async_return</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;async_return&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_ended&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">init_sample_size</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>    <span class="k">if</span> <span class="n">gen_count</span> <span class="o">&lt;</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_gens_started&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="linenos"> 74</span>        <span class="c1"># When a persistent worker is done, trigger a shutdown (returning exit condition of 1)</span>
<span class="linenos"> 75</span>        <span class="k">return</span> <span class="n">Work</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="mi">1</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="c1"># Give evaluated results back to a running persistent gen</span>
<span class="linenos"> 78</span>    <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">persistent</span><span class="o">=</span><span class="n">EVAL_GEN_TAG</span><span class="p">,</span> <span class="n">active_recv</span><span class="o">=</span><span class="n">active_recv_gen</span><span class="p">):</span>
<span class="linenos"> 79</span>        <span class="n">gen_inds</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="s2">&quot;gen_worker&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wid</span>
<span class="linenos"> 80</span>        <span class="n">returned_but_not_given</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_ended&quot;</span><span class="p">],</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;gen_informed&quot;</span><span class="p">],</span> <span class="n">gen_inds</span><span class="p">))</span>
<span class="linenos"> 81</span>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">returned_but_not_given</span><span class="p">):</span>
<span class="linenos"> 82</span>            <span class="k">if</span> <span class="n">async_return</span> <span class="ow">or</span> <span class="n">support</span><span class="o">.</span><span class="n">all_sim_ended</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">gen_inds</span><span class="p">):</span>
<span class="linenos"> 83</span>                <span class="n">point_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">returned_but_not_given</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 84</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">gen_work</span><span class="p">(</span>
<span class="linenos"> 85</span>                    <span class="n">wid</span><span class="p">,</span>
<span class="linenos"> 86</span>                    <span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;persis_in&quot;</span><span class="p">],</span>
<span class="linenos"> 87</span>                    <span class="n">point_ids</span><span class="p">,</span>
<span class="linenos"> 88</span>                    <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">),</span>
<span class="linenos"> 89</span>                    <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 90</span>                    <span class="n">active_recv</span><span class="o">=</span><span class="n">active_recv_gen</span><span class="p">,</span>
<span class="linenos"> 91</span>                <span class="p">)</span>
<span class="linenos"> 92</span>                <span class="n">returned_but_not_given</span><span class="p">[</span><span class="n">point_ids</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>    <span class="c1"># Now the give_sim_work_first part</span>
<span class="linenos"> 95</span>    <span class="n">points_to_evaluate</span> <span class="o">=</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;sim_started&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;cancel_requested&quot;</span><span class="p">]</span>
<span class="linenos"> 96</span>    <span class="n">avail_workers</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">persistent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_resource_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gen_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 97</span>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alt_type&quot;</span><span class="p">):</span>
<span class="linenos"> 98</span>        <span class="n">avail_workers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<span class="linenos"> 99</span>            <span class="nb">set</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">persistent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_resource_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="linenos">100</span>            <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">persistent</span><span class="o">=</span><span class="n">EVAL_SIM_TAG</span><span class="p">,</span> <span class="n">zero_resource_workers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="linenos">101</span>        <span class="p">)</span>
<span class="linenos">102</span>    <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">avail_workers</span><span class="p">:</span>
<span class="linenos">103</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">points_to_evaluate</span><span class="p">):</span>
<span class="linenos">104</span>            <span class="k">break</span>
<span class="linenos">105</span>
<span class="linenos">106</span>        <span class="n">sim_ids_to_send</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">points_by_priority</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">points_avail</span><span class="o">=</span><span class="n">points_to_evaluate</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">batch_give</span><span class="p">)</span>
<span class="linenos">107</span>
<span class="linenos">108</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">109</span>            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alt_type&quot;</span><span class="p">):</span>
<span class="linenos">110</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">sim_work</span><span class="p">(</span>
<span class="linenos">111</span>                    <span class="n">wid</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">],</span> <span class="n">sim_ids_to_send</span><span class="p">,</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">),</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos">112</span>                <span class="p">)</span>
<span class="linenos">113</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">114</span>                <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">sim_work</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">],</span> <span class="n">sim_ids_to_send</span><span class="p">,</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">))</span>
<span class="linenos">115</span>        <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">116</span>            <span class="k">break</span>
<span class="linenos">117</span>
<span class="linenos">118</span>        <span class="n">points_to_evaluate</span><span class="p">[</span><span class="n">sim_ids_to_send</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">119</span>
<span class="linenos">120</span>    <span class="c1"># Start persistent gens if no worker to give out. Uses zero_resource_workers if defined.</span>
<span class="linenos">121</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">points_to_evaluate</span><span class="p">):</span>
<span class="linenos">122</span>        <span class="n">avail_workers</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">avail_worker_ids</span><span class="p">(</span><span class="n">persistent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zero_resource_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gen_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span>        <span class="k">for</span> <span class="n">wid</span> <span class="ow">in</span> <span class="n">avail_workers</span><span class="p">:</span>
<span class="linenos">125</span>            <span class="k">if</span> <span class="n">gen_count</span> <span class="o">&lt;</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_active_gens&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">126</span>                <span class="c1"># Finally, start a persistent generator as there is nothing else to do.</span>
<span class="linenos">127</span>                <span class="k">try</span><span class="p">:</span>
<span class="linenos">128</span>                    <span class="n">Work</span><span class="p">[</span><span class="n">wid</span><span class="p">]</span> <span class="o">=</span> <span class="n">support</span><span class="o">.</span><span class="n">gen_work</span><span class="p">(</span>
<span class="linenos">129</span>                        <span class="n">wid</span><span class="p">,</span>
<span class="linenos">130</span>                        <span class="n">gen_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="p">[]),</span>
<span class="linenos">131</span>                        <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span>
<span class="linenos">132</span>                        <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">wid</span><span class="p">),</span>
<span class="linenos">133</span>                        <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">134</span>                        <span class="n">active_recv</span><span class="o">=</span><span class="n">active_recv_gen</span><span class="p">,</span>
<span class="linenos">135</span>                    <span class="p">)</span>
<span class="linenos">136</span>                <span class="k">except</span> <span class="n">InsufficientFreeResources</span><span class="p">:</span>
<span class="linenos">137</span>                    <span class="k">break</span>
<span class="linenos">138</span>
<span class="linenos">139</span>                <span class="n">persis_info</span><span class="p">[</span><span class="s2">&quot;num_gens_started&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">persis_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_gens_started&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">140</span>                <span class="n">gen_count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">141</span>
<span class="linenos">142</span>    <span class="k">return</span> <span class="n">Work</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</details></section>
<section id="module-start_persistent_local_opt_gens">
<span id="start-persistent-local-opt-gens"></span><h2>start_persistent_local_opt_gens<a class="headerlink" href="#module-start_persistent_local_opt_gens" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="start_persistent_local_opt_gens.start_persistent_local_opt_gens">
<span class="sig-prename descclassname"><span class="pre">start_persistent_local_opt_gens.</span></span><span class="sig-name descname"><span class="pre">start_persistent_local_opt_gens</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#start_persistent_local_opt_gens.start_persistent_local_opt_gens" title="Link to this definition"></a></dt>
<dd><p>This allocation function will do the following:</p>
<ul class="simple">
<li><p>Start up a persistent generator that is a local opt run at the first point
identified by APOSMM’s decide_where_to_start_localopt. Note, it will do
this only if at least one worker will be left to perform simulation evaluations.</p></li>
<li><p>If multiple starting points are available, the one with smallest function
value is chosen.</p></li>
<li><p>If no candidate starting points exist, points from existing runs will be
evaluated (oldest first).</p></li>
<li><p>If no points are left, call the generation function.</p></li>
</ul>
<p>tags: alloc, persistent, aposmm</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_uniform_sampling_then_persistent_localopt_runs.py">test_uniform_sampling_then_persistent_localopt_runs.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-fast_alloc_and_pausing">
<span id="fast-alloc-and-pausing"></span><h2>fast_alloc_and_pausing<a class="headerlink" href="#module-fast_alloc_and_pausing" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="fast_alloc_and_pausing.give_sim_work_first">
<span class="sig-prename descclassname"><span class="pre">fast_alloc_and_pausing.</span></span><span class="sig-name descname"><span class="pre">give_sim_work_first</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fast_alloc_and_pausing.give_sim_work_first" title="Link to this definition"></a></dt>
<dd><p>This allocation function gives (in order) entries in <code class="docutils literal notranslate"><span class="pre">H</span></code> to idle workers
to evaluate in the simulation function. The fields in <code class="docutils literal notranslate"><span class="pre">sim_specs[&quot;in&quot;]</span></code>
are given. If all entries in <cite>H</cite> have been given a be evaluated, a worker
is told to call the generator function, provided this wouldn’t result in
more than <code class="docutils literal notranslate"><span class="pre">alloc_specs[&quot;user&quot;][&quot;num_active_gen&quot;]</span></code> active generators. Also allows
for a “batch_mode”.</p>
<p>When there are multiple objective components, this allocation function
does not evaluate further components for some point in the following
scenarios:</p>
<dl class="simple">
<dt>alloc_specs[“user”][“stop_on_NaNs”]: True — after a NaN has been found in returned in some</dt><dd><p>objective component</p>
</dd>
<dt>alloc_specs[“user”][“stop_partial_fvec_eval”]: True — after the value returned from</dt><dd><p>combine_component_func is larger than a known upper bound on the objective.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_uniform_sampling_one_residual_at_a_time.py">test_uniform_sampling_one_residual_at_a_time.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-only_one_gen_alloc">
<span id="only-one-gen-alloc"></span><h2>only_one_gen_alloc<a class="headerlink" href="#module-only_one_gen_alloc" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="only_one_gen_alloc.ensure_one_active_gen">
<span class="sig-prename descclassname"><span class="pre">only_one_gen_alloc.</span></span><span class="sig-name descname"><span class="pre">ensure_one_active_gen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#only_one_gen_alloc.ensure_one_active_gen" title="Link to this definition"></a></dt>
<dd><p>This allocation function gives (in order) entries in <code class="docutils literal notranslate"><span class="pre">H</span></code> to idle workers
to evaluate in the simulation function. The fields in <code class="docutils literal notranslate"><span class="pre">sim_specs[&quot;in&quot;]</span></code>
are given. If there is no active generator, then one is started.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_fast_alloc.py">test_fast_alloc.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-start_fd_persistent">
<span id="start-fd-persistent"></span><h2>start_fd_persistent<a class="headerlink" href="#module-start_fd_persistent" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="start_fd_persistent.finite_diff_alloc">
<span class="sig-prename descclassname"><span class="pre">start_fd_persistent.</span></span><span class="sig-name descname"><span class="pre">finite_diff_alloc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#start_fd_persistent.finite_diff_alloc" title="Link to this definition"></a></dt>
<dd><p>This allocation function will give simulation work if possible, but
otherwise start 1 persistent generator.  If all points requested by
the persistent generator for a given (x_ind, f_ind) pair have been returned from the
simulation evaluation, then this information is given back to the
persistent generator (where x_ind is in range(n) and f_ind is in range(p))</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/regression_tests/test_persistent_fd_param_finder.py">test_persistent_fd_param_finder.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-persistent_aposmm_alloc">
<span id="persistent-aposmm-alloc"></span><h2>persistent_aposmm_alloc<a class="headerlink" href="#module-persistent_aposmm_alloc" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="persistent_aposmm_alloc.persistent_aposmm_alloc">
<span class="sig-prename descclassname"><span class="pre">persistent_aposmm_alloc.</span></span><span class="sig-name descname"><span class="pre">persistent_aposmm_alloc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#persistent_aposmm_alloc.persistent_aposmm_alloc" title="Link to this definition"></a></dt>
<dd><p>This allocation function will give simulation work if possible, but
otherwise start a persistent APOSMM generator.  If all points requested by
the persistent generator have been returned from the simulation evaluation,
then this information is given back to the persistent generator.</p>
<p>This function assumes that one persistent APOSMM will be started and never
stopped (until some exit_criterion is satisfied).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/regression_tests/test_persistent_aposmm_with_grad.py">test_persistent_aposmm_with_grad.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-give_pregenerated_work">
<span id="give-pregenerated-work"></span><h2>give_pregenerated_work<a class="headerlink" href="#module-give_pregenerated_work" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="give_pregenerated_work.give_pregenerated_sim_work">
<span class="sig-prename descclassname"><span class="pre">give_pregenerated_work.</span></span><span class="sig-name descname"><span class="pre">give_pregenerated_sim_work</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#give_pregenerated_work.give_pregenerated_sim_work" title="Link to this definition"></a></dt>
<dd><p>This allocation function gives (in order) entries in alloc_spec[“x”] to
idle workers. It is an example use case where no gen_func is used.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/Libensemble/libensemble/blob/develop/libensemble/tests/functionality_tests/test_fast_alloc.py">test_fast_alloc.py</a></p>
</div>
</dd></dl>

</section>
<section id="module-inverse_bayes_allocf">
<span id="inverse-bayes-allocf"></span><h2>inverse_bayes_allocf<a class="headerlink" href="#module-inverse_bayes_allocf" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="inverse_bayes_allocf.only_persistent_gens_for_inverse_bayes">
<span class="sig-prename descclassname"><span class="pre">inverse_bayes_allocf.</span></span><span class="sig-name descname"><span class="pre">only_persistent_gens_for_inverse_bayes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sim_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alloc_specs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">persis_info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">libE_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#inverse_bayes_allocf.only_persistent_gens_for_inverse_bayes" title="Link to this definition"></a></dt>
<dd><p>Starts up to gen_count number of persistent generators.
These persistent generators produce points (x) in batches and subbatches.
The points x are given in subbatches to workers to perform a calculation.
When all subbatches have returned, their output is given back to the
corresponding persistent generator.</p>
<p>The first time called there are no persis_w 1st for loop is not done</p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sim_funcs/mock_sim.html" class="btn btn-neutral float-left" title="Mock simulation evaluations (re-run using history file)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="calling_scripts.html" class="btn btn-neutral float-right" title="Calling Scripts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Argonne National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>