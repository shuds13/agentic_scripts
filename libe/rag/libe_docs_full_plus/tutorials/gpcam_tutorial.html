

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Surrogate Modeling with gpCAM &mdash; libEnsemble</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/my_theme.css?v=dd6640cf" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="shortcut icon" href="../_static/libE_logo_circle.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=bcd630d1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimization with APOSMM" href="aposmm_tutorial.html" />
    <link rel="prev" title="Executor - Assign GPUs" href="forces_gpu_tutorial.html" /> 
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="libensemble" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/tutorials/gpcam_tutorial.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/libE_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_installation.html">Advanced Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview_usecases.html">Understanding libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming_libE.html">Constructing Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_libE.html">Running libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/platforms_index.html">Running on HPC Systems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="local_sine_tutorial.html">Simple Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor_forces_tutorial.html">Ensemble with an MPI Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="forces_gpu_tutorial.html">Executor - Assign GPUs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Surrogate Modeling with gpCAM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generator-function">Generator function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulator-function">Simulator function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calling-script">Calling Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rerun-and-test-model-at-known-points">Rerun and test model at known points</a></li>
<li class="toctree-l2"><a class="reference internal" href="#viewing-model-progression">Viewing model progression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aposmm_tutorial.html">Optimization with APOSMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="calib_cancel_tutorial.html">Calibration with Simulation Cancellation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/gen_funcs.html">Generator Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/sim_funcs.html">Simulation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/alloc_funcs.html">Allocation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/calling_scripts.html">Calling Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/submission_scripts.html">Submission Scripts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to libEnsemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../posters.html">Posters and Presentations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/release_management/release_index.html">Release Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/dev_API/developer_API.html">Internal Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">libEnsemble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Surrogate Modeling with gpCAM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/gpcam_tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="surrogate-modeling-with-gpcam">
<h1>Surrogate Modeling with gpCAM<a class="headerlink" href="#surrogate-modeling-with-gpcam" title="Link to this heading"></a></h1>
<p>This example uses <a class="reference external" href="https://github.com/lbl-camera/gpCAM">gpCAM</a> to construct a global surrogate of <code class="docutils literal notranslate"><span class="pre">f</span></code> values using a Gaussian process.</p>
<p>In each iteration, a batch of points is produced for concurrent evaluation, maximizing uncertainty reduction.</p>
<p><a class="reference external" href="http://colab.research.google.com/github/Libensemble/libensemble/blob/develop/examples/tutorials/gpcam_surrogate_model/gpcam.ipynb"><img alt="Open in Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>Ensure that libEnsemble, and gpCAM are installed via: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">libensemble</span> <span class="pre">gpcam</span></code></p>
<section id="generator-function">
<h2>Generator function<a class="headerlink" href="#generator-function" title="Link to this heading"></a></h2>
<p>The gpCAM generator function is called <code class="docutils literal notranslate"><span class="pre">persistent_gpCAM</span></code>.</p>
<p>This persistent generator is started at the beginning of the Ensemble and runs until the Ensemble closes down.</p>
<p>This version (and others) of the gpCAM generator can be found at <a class="reference external" href="https://github.com/Libensemble/libensemble/blob/main/libensemble/gen_funcs/persistent_gpCAM.py">libensemble/gen_funcs/persistent_gpCAM.py</a> and can be imported from that location when libEnsemble is installed as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">libensemble.gen_funcs.persistent_gpCAM</span> <span class="pre">import</span> <span class="pre">persistent_gpCAM</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.lib.recfunctions</span><span class="w"> </span><span class="kn">import</span> <span class="n">repack_fields</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpcam</span><span class="w"> </span><span class="kn">import</span> <span class="n">GPOptimizer</span> <span class="k">as</span> <span class="n">GP</span>

<span class="c1"># Standard options for manager/generator comms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.message_numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">EVAL_GEN_TAG</span><span class="p">,</span> <span class="n">FINISHED_PERSISTENT_GEN_TAG</span><span class="p">,</span> <span class="n">PERSIS_STOP</span><span class="p">,</span> <span class="n">STOP_TAG</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.tools.persistent_support</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersistentSupport</span>

<span class="k">def</span><span class="w"> </span><span class="nf">persistent_gpCAM</span><span class="p">(</span><span class="n">H_in</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">gen_specs</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a batched gpCAM model to create a surrogate&quot;&quot;&quot;</span>

    <span class="c1"># Initialize</span>
    <span class="n">rng</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">_initialize_gpcAM</span><span class="p">(</span><span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">libE_info</span><span class="p">)</span>
    <span class="n">ask_max_iter</span> <span class="o">=</span> <span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ask_max_iter&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">10</span>
    <span class="n">test_points</span> <span class="o">=</span> <span class="n">_read_testpoints</span><span class="p">(</span><span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">])</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># Initializes noise</span>
    <span class="n">my_gp</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Start with a batch of random points</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">H_o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">])</span>
    <span class="n">H_o</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="n">tag</span><span class="p">,</span> <span class="n">Work</span><span class="p">,</span> <span class="n">calc_in</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">send_recv</span><span class="p">(</span><span class="n">H_o</span><span class="p">)</span>  <span class="c1"># Send random points for evaluation and wait for results</span>

    <span class="k">while</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">STOP_TAG</span><span class="p">,</span> <span class="n">PERSIS_STOP</span><span class="p">]:</span>
        <span class="n">y_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">calc_in</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">my_gp</span> <span class="o">=</span> <span class="n">_update_gp</span><span class="p">(</span><span class="n">my_gp</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">test_points</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>

        <span class="c1"># Request new points</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">my_gp</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span>
            <span class="n">input_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)),</span>
            <span class="n">n</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">pop_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">acquisition_function</span><span class="o">=</span><span class="s2">&quot;total correlation&quot;</span><span class="p">,</span>
            <span class="n">max_iter</span><span class="o">=</span><span class="n">ask_max_iter</span><span class="p">,</span>  <span class="c1"># Larger takes longer. gpCAM default is 20.</span>
        <span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>

        <span class="n">H_o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gen_specs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">])</span>
        <span class="n">H_o</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
        <span class="n">tag</span><span class="p">,</span> <span class="n">Work</span><span class="p">,</span> <span class="n">calc_in</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">send_recv</span><span class="p">(</span><span class="n">H_o</span><span class="p">)</span>  <span class="c1"># Send points for evaluation and wait for results</span>

    <span class="c1"># If final points were returned update the model</span>
    <span class="k">if</span> <span class="n">calc_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">calc_in</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">my_gp</span> <span class="o">=</span> <span class="n">_update_gp</span><span class="p">(</span><span class="n">my_gp</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">test_points</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">FINISHED_PERSISTENT_GEN_TAG</span>
</pre></div>
</div>
<p>Common acquisition functions include:</p>
<p><strong>Uncertainty reduction:</strong></p>
<ul class="simple">
<li><p><strong>“variance”</strong> (default): The optimizer will produce N best points.</p></li>
<li><p><strong>“total correlation”</strong>: More expensive but points produced are self-avoiding.</p></li>
</ul>
<p><strong>Bayesian optimization:</strong></p>
<p>These produce one point at a time unless using the <a class="reference external" href="https://ieeexplore.ieee.org/abstract/document/9652812">HGDL</a> option.</p>
<ul class="simple">
<li><p><strong>“ucb” / “lcb”</strong>: Upper/Lower Confidence Bound.</p></li>
<li><p><strong>“expected improvement”</strong>: Expected Improvement.</p></li>
</ul>
<p>For more options see: <a class="reference external" href="https://gpcam.lbl.gov/examples/acquisition-functions">https://gpcam.lbl.gov/examples/acquisition-functions</a></p>
<hr class="docutils" />
<p>The following code adds the functions used by <code class="docutils literal notranslate"><span class="pre">persistent_gpCAM</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">_update_gp</span></code> is where the GP is fed the data and trained.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_initialize_gpcAM</span><span class="p">(</span><span class="n">user_specs</span><span class="p">,</span> <span class="n">libE_info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract user params&quot;&quot;&quot;</span>
    <span class="n">rng_seed</span> <span class="o">=</span> <span class="n">user_specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rng_seed&quot;</span><span class="p">)</span>  <span class="c1"># will default to None</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">rng_seed</span><span class="p">)</span>  <span class="c1"># Create random stream</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">user_specs</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">user_specs</span><span class="p">[</span><span class="s2">&quot;lb&quot;</span><span class="p">])</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">user_specs</span><span class="p">[</span><span class="s2">&quot;ub&quot;</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span>  <span class="c1"># no. of dimensions</span>
    <span class="n">init_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">init_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">PersistentSupport</span><span class="p">(</span><span class="n">libE_info</span><span class="p">,</span> <span class="n">EVAL_GEN_TAG</span><span class="p">)</span>  <span class="c1"># init comms</span>
    <span class="k">return</span> <span class="n">rng</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">init_x</span><span class="p">,</span> <span class="n">init_y</span><span class="p">,</span> <span class="n">ps</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_read_testpoints</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read numpy file containing evaluated points for measuring GP error&quot;&quot;&quot;</span>
    <span class="n">test_points_file</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;test_points_file&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test_points_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">test_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">test_points_file</span><span class="p">)</span>
    <span class="n">test_points</span> <span class="o">=</span> <span class="n">repack_fields</span><span class="p">(</span><span class="n">test_points</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">test_points</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_compare_testpoints</span><span class="p">(</span><span class="n">my_gp</span><span class="p">,</span> <span class="n">test_points</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare model at test points&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">test_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">f_est</span> <span class="o">=</span> <span class="n">my_gp</span><span class="o">.</span><span class="n">posterior_mean</span><span class="p">(</span><span class="n">test_points</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])[</span><span class="s2">&quot;f(x)&quot;</span><span class="p">]</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">f_est</span> <span class="o">-</span> <span class="n">test_points</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">persis_info</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;mean_squared_error&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_gp</span><span class="p">(</span><span class="n">my_gp</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">test_points</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">noise</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update Gaussian process with new points and train&quot;&quot;&quot;</span>
    <span class="n">noise_arr</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_new</span><span class="p">))</span>  <span class="c1"># Initializes noise</span>
    <span class="k">if</span> <span class="n">my_gp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">my_gp</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">noise_variances</span><span class="o">=</span><span class="n">noise_arr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_gp</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">noise_variances</span><span class="o">=</span><span class="n">noise_arr</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">my_gp</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">test_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_compare_testpoints</span><span class="p">(</span><span class="n">my_gp</span><span class="p">,</span> <span class="n">test_points</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">my_gp</span>
</pre></div>
</div>
</section>
<section id="simulator-function">
<h2>Simulator function<a class="headerlink" href="#simulator-function" title="Link to this heading"></a></h2>
<p>Simulator functions or <code class="docutils literal notranslate"><span class="pre">sim_f</span></code>s perform calculations based on parameters created in the generator function.
Each worker runs a copy of this function in parallel.</p>
<p>The function here is the simple 2D <code class="docutils literal notranslate"><span class="pre">six_hump_camel</span></code>, for demonstration purposes.</p>
<p>For running applications using parallel resources in the simulator see the <a class="reference external" href="https://github.com/Libensemble/libensemble/tree/main/libensemble/tests/scaling_tests/forces/forces_simple">forces examples</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define our simulation function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">six_hump_camel</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">sim_specs</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Six-Hump Camel sim_f.&quot;&quot;&quot;</span>

    <span class="n">batch</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>  <span class="c1"># Num evaluations each sim_f call.</span>
    <span class="n">H_o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sim_specs</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">])</span>  <span class="c1"># Define output array H</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]):</span>
        <span class="n">H_o</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">six_hump_camel_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Function evaluations placed into H</span>

    <span class="k">return</span> <span class="n">H_o</span><span class="p">,</span> <span class="n">persis_info</span>


<span class="k">def</span><span class="w"> </span><span class="nf">six_hump_camel_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Six-Hump Camel function definition&quot;&quot;&quot;</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mf">2.1</span> <span class="o">*</span> <span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">x1</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span>
    <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>
</pre></div>
</div>
</section>
<section id="calling-script">
<h2>Calling Script<a class="headerlink" href="#calling-script" title="Link to this heading"></a></h2>
<p>Our calling script configures libEnsemble, the generator function, and the simulator function. It then create the ensemble object and runs the ensemble.</p>
<p>First we will create a cleanup script so we can easily re-run.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># To rerun this notebook, we need to delete the ensemble directory.</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>This calling script imports the Gen and Sim functions from the locations in the installed libensemble package.
If you wish to make your own functions based on the above, those can be imported instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ensemble</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.specs</span><span class="w"> </span><span class="kn">import</span> <span class="n">LibeSpecs</span><span class="p">,</span> <span class="n">GenSpecs</span><span class="p">,</span> <span class="n">SimSpecs</span><span class="p">,</span> <span class="n">AllocSpecs</span><span class="p">,</span> <span class="n">ExitCriteria</span>

<span class="c1"># If importing from libensemble</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.gen_funcs.persistent_gpCAM</span><span class="w"> </span><span class="kn">import</span> <span class="n">persistent_gpCAM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.sim_funcs.six_hump_camel</span><span class="w"> </span><span class="kn">import</span> <span class="n">six_hump_camel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">libensemble.alloc_funcs.start_only_persistent</span><span class="w"> </span><span class="kn">import</span> <span class="n">only_persistent_gens</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Default hyperparameter_bounds&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Hyperparameters initialized&quot;</span><span class="p">)</span>

<span class="n">nworkers</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># When using gen_on_manager, nworkers is number of concurrent sims.</span>
<span class="c1"># final_gen_send means the last evaluated points are returned to the generator to update the model.</span>
<span class="n">libE_specs</span> <span class="o">=</span> <span class="n">LibeSpecs</span><span class="p">(</span><span class="n">nworkers</span><span class="o">=</span><span class="n">nworkers</span><span class="p">,</span> <span class="n">gen_on_manager</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">final_gen_send</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Input dimensions</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">num_batches</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">gen_specs</span> <span class="o">=</span> <span class="n">GenSpecs</span><span class="p">(</span>
    <span class="n">gen_f</span><span class="o">=</span><span class="n">persistent_gpCAM</span><span class="p">,</span>        <span class="c1"># Generator function</span>
    <span class="n">persis_in</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">],</span>               <span class="c1"># Objective, defined in sim, is returned to gen</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,))],</span>  <span class="c1"># Parameters (name, type, size)</span>
    <span class="n">user</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">batch_size</span><span class="p">,</span>
        <span class="s2">&quot;lb&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># lower boundaries for n dimensions</span>
        <span class="s2">&quot;ub&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>    <span class="c1"># upper boundaries for n dimensions</span>
        <span class="s2">&quot;ask_max_iter&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>         <span class="c1"># Number of iterations for ask (default 20)</span>
        <span class="s2">&quot;rng_seed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">sim_specs</span> <span class="o">=</span> <span class="n">SimSpecs</span><span class="p">(</span>
    <span class="n">sim_f</span><span class="o">=</span><span class="n">six_hump_camel</span><span class="p">,</span>      <span class="c1"># Simulator function</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>              <span class="c1"># Input field names. &quot;x&quot; defined in gen</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)],</span>    <span class="c1"># Objective</span>
<span class="p">)</span>

<span class="c1"># Starts one persistent generator. Simulated values are returned in batch.</span>
<span class="n">alloc_specs</span> <span class="o">=</span> <span class="n">AllocSpecs</span><span class="p">(</span>
    <span class="n">alloc_f</span><span class="o">=</span><span class="n">only_persistent_gens</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;async_return&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># False = batch returns</span>
<span class="p">)</span>

<span class="n">exit_criteria</span> <span class="o">=</span> <span class="n">ExitCriteria</span><span class="p">(</span><span class="n">sim_max</span><span class="o">=</span><span class="n">num_batches</span><span class="o">*</span><span class="n">batch_size</span><span class="p">)</span>

<span class="c1"># Initialize and run the ensemble.</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">(</span>
    <span class="n">libE_specs</span><span class="o">=</span><span class="n">libE_specs</span><span class="p">,</span>
    <span class="n">sim_specs</span><span class="o">=</span><span class="n">sim_specs</span><span class="p">,</span>
    <span class="n">gen_specs</span><span class="o">=</span><span class="n">gen_specs</span><span class="p">,</span>
    <span class="n">alloc_specs</span><span class="o">=</span><span class="n">alloc_specs</span><span class="p">,</span>
    <span class="n">exit_criteria</span><span class="o">=</span><span class="n">exit_criteria</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>At the end of our calling script we run the ensemble.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># To ensure re-running works - clean output and reset any persistent information</span>
<span class="n">cleanup</span><span class="p">()</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">persis_info</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">H</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># Start the ensemble. Blocks until completion.</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">save_output</span><span class="p">(</span><span class="s2">&quot;H_array&quot;</span><span class="p">,</span> <span class="n">append_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Save H (history of all evaluated points) to file</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">H</span><span class="p">[[</span><span class="s2">&quot;sim_id&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">]][:</span><span class="mi">16</span><span class="p">])</span> <span class="c1"># See first 16 results</span>
</pre></div>
</div>
</section>
<section id="rerun-and-test-model-at-known-points">
<h2>Rerun and test model at known points<a class="headerlink" href="#rerun-and-test-model-at-known-points" title="Link to this heading"></a></h2>
<p>To see how the accuracy of the surrogate model improves, we can use previously evaluated points as test points and run again with a different seed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ensemble</span><span class="o">.</span><span class="n">gen_specs</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;rng_seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">gen_specs</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;test_points_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;H_array.npy&quot;</span>  <span class="c1"># our previous file</span>

<span class="c1"># To ensure re-running works - clean output and reset any persistent information</span>
<span class="n">cleanup</span><span class="p">()</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">persis_info</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">H</span><span class="p">,</span> <span class="n">persis_info</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">persis_info</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="viewing-model-progression">
<h2>Viewing model progression<a class="headerlink" href="#viewing-model-progression" title="Link to this heading"></a></h2>
<p>Now we can check how our model’s values compared against the values at known test points as the ensemble progresses.
The comparison is based on the <strong>mean squared error</strong> between the gpCAM model and our known
values at the test points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Get &quot;mean_squared_error&quot; from generators return (worker 0 as we ran gen_on_manager)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">persis_info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;mean_squared_error&quot;</span><span class="p">]</span>
<span class="n">niter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<span class="n">num_sims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="p">(</span><span class="n">niter</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">))</span>

<span class="c1"># Plotting the data</span>
<span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">num_sims</span><span class="p">,</span> <span class="n">mse</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mean squared error&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_sims</span><span class="p">)</span>

<span class="c1"># Labeling the axes and the legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error at test points&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of simulations&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean squared error (rad$^2$)&#39;</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>  <span class="c1"># Increase edge width here</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The plot should look similar to the following.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The graph may differ between runs because, although we seed libEnsemble’s random number generator,
gpCAM introduces some randomness when initializing hyperparameters.</p>
</div>
<img alt="gpcam_model_improvement" class="align-center" src="../_images/gpcam_model_improvement.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="forces_gpu_tutorial.html" class="btn btn-neutral float-left" title="Executor - Assign GPUs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aposmm_tutorial.html" class="btn btn-neutral float-right" title="Optimization with APOSMM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Argonne National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>